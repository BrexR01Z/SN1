{% extends 'base.html' %}
{% load static %}

{% block title %}Reservar - {{ cancha.nombre }}{% endblock %}

{% block extra_css %}
  <link rel="stylesheet" href="{% static 'crear_reserva.css' %}">
{% endblock %}

{% block content %}
<div class="reserva-container">
  <h1 class="reserva-title">Reservar Cancha</h1>

  <div class="cancha-info">
    <div class="info-item">
      <span class="info-label">Cancha:</span>
      <span class="info-valor">{{ cancha.nombre }}</span>
    </div>
    <div class="info-item">
      <span class="info-label">Establecimiento:</span>
      <span class="info-valor">{{ cancha.establecimiento.nombre }}</span>
    </div>
    <div class="info-item">
      <span class="info-label">Deporte:</span>
      <span class="info-valor">{{ cancha.get_deporte_display }}</span>
    </div>
    <div class="info-item">
      <span class="info-label">Precio por bloque (30 min):</span>
      <span class="precio-destaque">${{ cancha.valor_por_bloque }}</span>
    </div>
  </div>

  <form method="POST" class="formulario">
    {% csrf_token %}

    <div class="form-group">
      <label for="{{ form.fecha.id_for_label }}">{{ form.fecha.label }}</label>
      {{ form.fecha }}
      {% if form.fecha.help_text %}<span class="helptext">{{ form.fecha.help_text }}</span>{% endif %}
      {% if form.fecha.errors %}<span class="error-message">{{ form.fecha.errors.0 }}</span>{% endif %}
    </div>

    <div class="form-group">
      <label for="{{ form.hora_inicio.id_for_label }}">{{ form.hora_inicio.label }}</label>
      {{ form.hora_inicio }}
      {% if form.hora_inicio.errors %}<span class="error-message">{{ form.hora_inicio.errors.0 }}</span>{% endif %}
    </div>

    <div class="form-group">
      <label for="{{ form.duracion_bloques.id_for_label }}">{{ form.duracion_bloques.label }}</label>
      {{ form.duracion_bloques }}
      {% if form.duracion_bloques.help_text %}<span class="helptext">{{ form.duracion_bloques.help_text }}</span>{% endif %}
      {% if form.duracion_bloques.errors %}<span class="error-message">{{ form.duracion_bloques.errors.0 }}</span>{% endif %}
    </div>

    <div class="form-group">
      <label for="{{ form.comentario.id_for_label }}">{{ form.comentario.label }}</label>
      {{ form.comentario }}
      {% if form.comentario.help_text %}<span class="helptext">{{ form.comentario.help_text }}</span>{% endif %}
    </div>

    <div class="resumen">
      <div class="resumen-item">
        <span>Bloque de 30 min:</span>
        <span>${{ cancha.valor_por_bloque }}</span>
      </div>
      <div class="resumen-item">
        <span id="cantidad-label">Cantidad (1 bloque):</span>
        <span id="cantidad-valor">1 × ${{ cancha.valor_por_bloque }}</span>
      </div>
      <div class="resumen-item">
        <span>Total:</span>
        <span id="total-precio">${{ cancha.valor_por_bloque }}</span>
      </div>
    </div>

    <button type="submit" class="boton-reservar">Confirmar Reserva</button>
  </form>

  <div class="volver">
    <a href="{% url 'establecimientos:ver_establecimiento' cancha.establecimiento.id %}">Volver al establecimiento</a>
  </div>
</div>

<script>
  const duracionInput = document.querySelector('input[name="duracion_bloques"]');
  const precioBase = {{ cancha.valor_por_bloque }};

  if (duracionInput) {
    duracionInput.addEventListener('change', actualizarPrecio);
    duracionInput.addEventListener('input', actualizarPrecio);
  }

  function actualizarPrecio() {
    const duracion = parseInt(duracionInput.value) || 1;
    const total = precioBase * duracion;
    document.getElementById('cantidad-label').textContent = `Cantidad (${duracion} bloque${duracion > 1 ? 's' : '}):`;
    document.getElementById('cantidad-valor').textContent = `${duracion} × $${precioBase}`;
    document.getElementById('total-precio').textContent = `$${total}`;
  }
</script>

{% endblock %}